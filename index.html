<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Operations Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .dashboard {
      max-width: 1200px;
      width: 95%;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      opacity: 0;
      transform: translateY(20px);
    }
    .card.show {
      opacity: 1;
      transform: translateY(0);
      transition: all 0.6s ease-out;
    }
    .metric {
      font-size: 24px;
      font-weight: bold;
    }
    .good { color: green; }
    .warn { color: orange; }
    .bad { color: red; }
    .arrow {
      font-size: 20px;
      margin-left: 8px;
    }
    canvas {
      margin-top: 20px;
      background: white;
      border-radius: 10px;
      padding: 10px;
    }
    #map {
      height: 400px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <h1>ðŸ“Š Operations Dashboard</h1>

    <div class="cards">
      <div class="card" id="daily-card">
        <h3>Daily</h3>
        <div id="daily-answer" class="metric"></div>
        <div id="daily-abandon" class="metric"></div>
      </div>
      <div class="card" id="weekly-card">
        <h3>Weekly</h3>
        <div id="weekly-answer" class="metric"></div>
        <div id="weekly-abandon" class="metric"></div>
      </div>
      <div class="card" id="monthly-card">
        <h3>Monthly</h3>
        <div id="monthly-answer" class="metric"></div>
        <div id="monthly-abandon" class="metric"></div>
      </div>
    </div>

    <canvas id="salesChart"></canvas>
    <div id="map"></div>
  </div>

  <script>
    const API_URL = "YOUR_APPS_SCRIPT_URL"; // Replace with your script

    // Animate numbers
    function animateValue(id, start, end, duration, suffix="", arrowDir=null) {
      const obj = document.getElementById(id);
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.textContent = (Math.floor(progress * (end - start) + start)) + suffix;

        if (progress < 1) {
          window.requestAnimationFrame(step);
        } else if (arrowDir) {
          obj.innerHTML += arrowDir === "up" 
            ? `<span class="arrow good">â†‘</span>` 
            : `<span class="arrow bad">â†“</span>`;
        }
      };
      window.requestAnimationFrame(step);
    }

    // Load Google GeoChart
    google.charts.load("current", { packages: ["geochart"] });
    google.charts.setOnLoadCallback(drawDashboard);

    async function drawDashboard() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        // Show cards with animation
        document.querySelectorAll(".card").forEach(card => {
          setTimeout(() => card.classList.add("show"), 200);
        });

        // Function to color-code
        function getClass(value) {
          if (value >= 80) return "good";
          if (value >= 50) return "warn";
          return "bad";
        }

        // Daily
        let dailyAnswer = data.daily.answerRate;
        let dailyAbandon = data.daily.abandonRate;
        document.getElementById("daily-answer").className = "metric " + getClass(dailyAnswer);
        document.getElementById("daily-abandon").className = "metric " + getClass(dailyAbandon);
        animateValue("daily-answer", 0, dailyAnswer, 1500, "%", "up");
        animateValue("daily-abandon", 0, dailyAbandon, 1500, "%", "down");

        // Weekly
        let weeklyAnswer = data.weekly.answerRate;
        let weeklyAbandon = data.weekly.abandonRate;
        document.getElementById("weekly-answer").className = "metric " + getClass(weeklyAnswer);
        document.getElementById("weekly-abandon").className = "metric " + getClass(weeklyAbandon);
        animateValue("weekly-answer", 0, weeklyAnswer, 1500, "%", "up");
        animateValue("weekly-abandon", 0, weeklyAbandon, 1500, "%", "down");

        // Monthly
        let monthlyAnswer = data.monthly.answerRate;
        let monthlyAbandon = data.monthly.abandonRate;
        document.getElementById("monthly-answer").className = "metric " + getClass(monthlyAnswer);
        document.getElementById("monthly-abandon").className = "metric " + getClass(monthlyAbandon);
        animateValue("monthly-answer", 0, monthlyAnswer, 1500, "%", "up");
        animateValue("monthly-abandon", 0, monthlyAbandon, 1500, "%", "down");

        // Sales Chart
        const ctx = document.getElementById("salesChart");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: data.sales.labels,
            datasets: [{
              label: "Team Sales (â‚¬)",
              data: data.sales.values,
              borderColor: "#36a2eb",
              fill: false
            }]
          },
          options: { responsive: true }
        });

        // Geo Chart (heatmap)
        const geoData = [["Country", "Calls"]];
        for (const [country, count] of Object.entries(data.countries)) {
          geoData.push([country, count]);
        }
        const chartData = google.visualization.arrayToDataTable(geoData);
        const chart = new google.visualization.GeoChart(document.getElementById("map"));
        chart.draw(chartData, {});
      } catch (err) {
        console.error("Dashboard error:", err);
      }
    }
  </script>
</body>
</html>
